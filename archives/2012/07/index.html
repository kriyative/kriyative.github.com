<html lang="en"><head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><meta charset="UTF-8" /><meta name="description" /><meta name="keywords" /><meta name="author" /><link href="/assets/favicon.ico" rel="icon" type="image/x-icon" /><link href="/assets/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="/default.css" rel="stylesheet" type="text/css" /><link href="/rss.xml" rel="alternate" type="application/rss+xml" /><link href="http://fonts.googleapis.com/css?family=Snowburst+One" rel="stylesheet" type="text/css" /><title>Archives</title></head><body><header id="banner"><div class="sleeve"><hgroup id="nameplate"><h1 id="title"><a href="/"></a></h1><h2 id="description"></h2></hgroup><nav id="toc"><ul id="menu"><li class="menu-item"><a href="/archives">Archives</a></li><li class="menu-item"><a href="/tags">Tags</a></li><li class="menu-item"><a href="/rss.xml">Subscribe</a></li></ul></nav></div></header><div id="main"><div class="sleeve"><div id="content"><article class="post format-standard"><header class="post-header"><h1 class="post-title"><a href="/2012/07/28/emacs-for-clojure-2/">Emacs for Clojure - Part 2</a></h1><p class="post-meta">Posted on 28 Jul 2012</p></header><div class="post-content"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Editing Clojure</a></li>
<li><a href="#sec-2">2. Clojure REPL</a></li>
</ul>
</div>
</div>
<p>
This is the second in a two part post about a Clojure programmer
workflow entirely within Emacs.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Editing Clojure</h2>
<div class="outline-text-2" id="text-1">
<p>
Some useful navigation key bindings in Clojure-mode, actually any Lisp
code editing mode in Emacs, are as follows:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Keybinding</th>
<th scope="col" class="left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>C-M-f</code></td>
<td class="left"><code>forward-sexp</code></td>
</tr>

<tr>
<td class="left"><code>C-M-b</code></td>
<td class="left"><code>backward-sexp</code></td>
</tr>

<tr>
<td class="left"><code>C-M-a</code></td>
<td class="left"><code>beginning-of-defun</code></td>
</tr>

<tr>
<td class="left"><code>C-M-e</code></td>
<td class="left"><code>end-of-defun</code></td>
</tr>

<tr>
<td class="left"><code>C-M-x</code></td>
<td class="left"><code>slime-compile-defun</code></td>
</tr>

<tr>
<td class="left"><code>C-x C-e</code></td>
<td class="left"><code>slime-eval-last-expression</code></td>
</tr>
</tbody>
</table>

<p>
Some of these key bindings get redefined when a buffer is in
<code>slime-mode</code> to SLIME enhanced equivalents, but mostly they behave the
same.
</p>

<p>
And, don't forget the exponential effect of the <code>C-u</code> prefix key.
</p>

<p>
Some other key bindings that are also useful are:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Keybinding</th>
<th scope="col" class="left">Command</th>
<th scope="col" class="left">Doc</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>C-M-q</code></td>
<td class="left"><code>indent-sexp</code></td>
<td class="left">A lot of times when copying and pasting or otherwise modifying large blocks of s-expressions, the indentation of the code can get out of whack. <code>indent-sexp</code> can help restore the balance.</td>
</tr>

<tr>
<td class="left"><code>C-M-h</code></td>
<td class="left"><code>mark-defun</code></td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left"><code>C-M-k</code></td>
<td class="left"><code>kill-sexp</code></td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
Also worth knowing, the magic of <i>dynamic abbrevs</i> bound to the
@&lt;code&gt;M-/@&lt;/code&gt; key binding. Dynamic abbrevs are a quick way to
complete a long function or var name from a minimal prefix. It's very
brute force (i.e, just searches for a match in all the open buffers),
but since it's very fast, it comes in handy when you're working with
partially evaluated Clojure code.
</p>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Clojure REPL</h2>
<div class="outline-text-2" id="text-2">
<p>
Everything begins with a Clojure instance which has SWANK loaded.
Again, there are lots of ways of starting one of these, and the most
common use case is with a <a href="https://github.com/technomancy/leiningen/">Leiningen</a> project setup. Setting up
Leiningen is beyond the scope of this post, but the docs on
Leiningen's github page are quite helpful in getting you started.
</p>

<p>
Once Leiningen is setup and you have a <code>project.clj</code> file for your
project, you can invoke <code>clojure-jack-in</code>.
</p>

<p>
Once SLIME is connected, it's helpful to know the following commands:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Keybinding</th>
<th scope="col" class="left">Command</th>
<th scope="col" class="left">Doc</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">&#xa0;</td>
<td class="left"><code>slime-repl</code></td>
<td class="left">This is a quick way to jump to the <code>*slime-repl clojure*</code> buffer.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left"><code>slime-reset</code></td>
<td class="left">When your SLIME connection goes out of whack.</td>
</tr>

<tr>
<td class="left"><code>C-M-i</code></td>
<td class="left"><code>slime-complete-symbol</code></td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left"><code>C-x e</code></td>
<td class="left"><code>slime-eval-last-expression</code></td>
<td class="left">Makes every Clojure buffer into a REPL. Plus, it is very handy when iterating on tests.</td>
</tr>

<tr>
<td class="left"><code>C-c C-c</code>, <code>C-M-x</code></td>
<td class="left"><code>slime-compile-defun</code></td>
<td class="left">This is convenient for compiling a <code>defn</code> or other top-level form, without having to put the cursor at the end of the expression.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left"><code>slime-list-connections</code></td>
<td class="left">If you find yourself having to connect to multiple SWANK servers this command is helpful in switching between them.</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left"><code>slime-list-threads</code></td>
<td class="left">Show the list of scheduled JVM threads, and can provides an interactive way to kill running threads. Use with caution.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><footer class="post-footer"></footer></article><article class="post format-standard"><header class="post-header"><h1 class="post-title"><a href="/2012/07/21/emacs-for-clojure-1/">Emacs for Clojure - Part 1</a></h1><p class="post-meta">Posted on 21 Jul 2012</p></header><div class="post-content"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Process</a></li>
<li><a href="#sec-2">2. Clojure Mode Setup</a></li>
<li><a href="#sec-3">3. Basic Editing</a></li>
<li><a href="#sec-4">4. Keyboard Macros</a></li>
</ul>
</div>
</div>
<p>
This is a brief overview of the way I work in Clojure using Emacs -
almost exclusively. Obviously, Emacs is not the only way to interact
with Clojure, but it can be a pretty seamless and efficient
environment for Clojure, once you become familiar with the powerful
extensibility and "mouse-free" efficiency of Emacs.
</p>

<p>
Also, since Emacs uses Lisp as its extension language, there's a lot
of value for a Clojure/Lisp developer in learning and mastering the
Emacs' ecosystem. I hope this series of posts will be helpful in that
endeavour.
</p>

<p>
There are lots of "getting started with Emacs" docs available online
and on the web. The easiest one is the built-in <a href="http://git.savannah.gnu.org/cgit/emacs.git/plain/etc/tutorials/TUTORIAL?h=emacs-24">Tutorial</a>, which you
can also bring up within Emacs with <code>C-h t</code> or <code>M-x
help-with-tutorial</code>.  Other online references:
</p>

<ol class="org-ol">
<li><a href="http://www.gnu.org/software/emacs/tour/">A Guided Tour of Emacs</a>
</li>

<li><a href="http://www2.lib.uchicago.edu/keith/tcl-course/emacs-tutorial.html">A Tutorial Introduction to GNU Emacs</a>
</li>
</ol>


<p>
For the most part, I'm going to assume you're using Emacs default key
bindings, but the following customizations don't really depend on
that.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Process</h2>
<div class="outline-text-2" id="text-1">
<p>
My typical work-flow involves the following steps (but not necessarily
in the same order always):
</p>

<pre class="example">
(loop []
  ;; Edit code/tests
  ;; Interactive development with REPL and tests
  ;; Look up documentation
  ;; Search and Navigate a code tree
  ;; Run batch tests
  ;; Merge commits and resolve conflicts in Git
  (recur))
</pre>

<p>
I'll try to cover each of these steps in detail over the course of the
next few posts.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Clojure Mode Setup</h2>
<div class="outline-text-2" id="text-2">
<p>
Like snowflakes and Sting albums, there are myriad ways of setting up
the Clojure environment in Emacs, but essentially all of them should
be doing something similar to the following:
</p>

<pre class="example">
(defun clojure-mode-hook ()
  (setq indent-tabs-mode nil
        clojure-mode-use-backtracking-indent t)
  (setup-clojure-indentation-rules))
(require 'clojure-mode)
(require 'clojure-test-mode)
(require 'swank-clojure)
(add-hook 'clojure-mode-hook 'clojure-mode-hook)
(add-hook 'clojure-mode-hook 'clojure-test-mode)
</pre>

<p>
If you are using Emacs 24 and have never setup Clojure-mode or SLIME
before, check out the <a href="https://github.com/technomancy/emacs-starter-kit">emacs-starter-kit</a>.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Basic Editing</h2>
<div class="outline-text-2" id="text-3">
<p>
It's good to get familiar with the basic cursor movement keys such as:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Keybinding</th>
<th scope="col" class="left">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>C-n</code></td>
<td class="left"><code>next-line</code></td>
</tr>

<tr>
<td class="left"><code>C-p</code></td>
<td class="left"><code>previous-line</code></td>
</tr>

<tr>
<td class="left"><code>C-f</code></td>
<td class="left"><code>forward-char</code></td>
</tr>

<tr>
<td class="left"><code>C-b</code></td>
<td class="left"><code>backward-char</code></td>
</tr>

<tr>
<td class="left"><code>C-a</code></td>
<td class="left"><code>move-beginning-of-line</code></td>
</tr>

<tr>
<td class="left"><code>C-e</code></td>
<td class="left"><code>move-end-of-line</code></td>
</tr>
</tbody>
</table>

<p>
There's been a lot of cursing and teeth gnashing about Emacs' default
key bindings, but here are some of the benefits that I've come to
appreciate over time:
</p>

<ol class="org-ol">
<li>Clustering &#x2013; you can insert and move around with minimal physical
movement from the <i>home row</i> of the keyboard.
</li>

<li>Easy to remember
</li>

<li>Work in <code>bash</code> and even on tty devices (never say never) - this is
particularly useful if you're planning to do some remote pairing
over <code>tmux</code> or <code>screen</code>
</li>
</ol>

<p>
And, there is always <code>C-h b</code> <code>describe-bindings</code> which will list the
key bindings in any given buffer.
</p>

<p>
Other useful basic key bindings:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Keybinding</th>
<th scope="col" class="left">Command</th>
<th scope="col" class="left">Doc</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>C-l</code></td>
<td class="left"><code>recenter</code></td>
<td class="left">redraw buffer with the current line at the vertical center of the window; one useful variation is to <code>C-u 0 C-l</code> which will redraw the buffer with the current line at the top of the window</td>
</tr>

<tr>
<td class="left"><code>C-SPC</code></td>
<td class="left"><code>set-mark-command</code></td>
<td class="left">set the beginning of a copy/cut region, and move the cursor to the end of the region</td>
</tr>

<tr>
<td class="left"><code>C-w</code></td>
<td class="left"><code>kill-region</code></td>
<td class="left">cut the contents of the selected region</td>
</tr>

<tr>
<td class="left"><code>M-w</code></td>
<td class="left"><code>kill-ring-save</code></td>
<td class="left">copy (not cut) the contents of the selected region</td>
</tr>

<tr>
<td class="left"><code>C-y</code></td>
<td class="left"><code>yank</code></td>
<td class="left">paste the most recently copied/cut region at cursor point</td>
</tr>

<tr>
<td class="left"><code>M-y</code></td>
<td class="left"><code>yank-pop</code></td>
<td class="left">when used after a <code>yank</code>, Emacs will replace the pasted region with older copied text cycling through the cut/copy history</td>
</tr>

<tr>
<td class="left"><code>C-x r k</code></td>
<td class="left"><code>kill-rectangle</code></td>
<td class="left">mark a region as you would normally, but cut a rectangular sub-region. Useful when working with columns of data</td>
</tr>

<tr>
<td class="left"><code>C-x r y</code></td>
<td class="left"><code>yank-rectangle</code></td>
<td class="left">paste the most recently killed rectangular region</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Keyboard Macros</h2>
<div class="outline-text-2" id="text-4">
<p>
We've all been in situations where we've had to fix up some literal
data structure or otherwise munge code by repeating a set of editing
keystrokes, either deleting, inserting or otherwise splicing
text. Keyboard macros can quickly help automate some of this work.
</p>

<p>
The basic principle is that you begin recording a macro <code>C-x (</code>
<code>kmacro-start-macro</code>, perform the keyboard actions, and then end
recording with <code>C-x )</code> <code>kmacro-end-macro</code>. You can then replay the
macro using <code>C-x e</code> <code>kmacro-end-and-call-macro</code>. Also, check out
<code>C-x C-k n</code> <code>kmacro-name-last-macro</code> for oft repeated macros.
</p>

<p>
<i>Next post:</i> REPL, SLIME and interactive programming.
</p>
</div>
</div>
</div><footer class="post-footer"></footer></article></div><aside id="sidebar"><section class="panel"><p><img id="profile-pic" src="http://www.gravatar.com/avatar/6dcf36ddd0aa73e04e125e3c10f6ff05.png" />Hi, I'm Ram Krishnan - a <a href="http://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a> programmer and software entrepreneur.</p></section><section class="panel"><h1>Links</h1><ul><li><a href="https://github.com/kriyative">Github</a></li><li><a href="http://www.ingeniousmonkey.com">IngeniousMonkey</a></li></ul><p>I sometimes post on <a href="http://twitter.com/funcall">twitter</a>.</p></section><section class="panel"><h1>Recent posts</h1><ul><li><a href="/2013/03/03/clojure-mode-and-slime/"> clojure-mode and slime</a></li><li><a href="/2013/03/02/clojure-emacs-docs-redux/"> clojure, emacs, and docs redux</a></li><li><a href="/2013/02/20/new-site/"> New Site</a></li><li><a href="/2012/07/28/emacs-for-clojure-2/">Emacs for Clojure - Part 2</a></li><li><a href="/2012/07/21/emacs-for-clojure-1/">Emacs for Clojure - Part 1</a></li><li><a href="/2011/03/26/ecl-for-ios-updated/">ECL for iOS update for ECL-11.1.1, Xocde 4, and SDK 4.3</a></li><li><a href="/2011/01/10/clojurejs-announcement/">clojurejs -- a Clojure (subset) to Javascript translator</a></li><li><a href="/2010/12/20/lisp-functions-ui-callbacks-ecl-ios/">Lisp functions as UI callbacks in ECL/iOS</a></li><li><a href="/2010/12/14/ecl-for-ios-updated/">ECL for iOS updated to work with SDK 4.2</a></li><li><a href="/2010/03/23/daily-org-agenda-reminder/">Displaying a daily Org-mode agenda reminder in Emacs</a></li></ul></section></aside></div></div><footer id="addendum"><div class="sleeve"><p id="copyright">Copyright © 2012–2013 Ram Krishnan</p></div></footer></body></html>