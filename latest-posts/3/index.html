<html lang="en"><head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><meta charset="UTF-8" /><meta content="" name="description" /><meta name="keywords" /><meta content="Ram Krishnan" name="author" /><link href="/assets/favicon.ico" rel="icon" type="image/x-icon" /><link href="/assets/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="/default.css" rel="stylesheet" type="text/css" /><link href="/rss.xml" rel="alternate" title="kriyative" type="application/rss+xml" /><link href="http://fonts.googleapis.com/css?family=Snowburst+One" rel="stylesheet" type="text/css" /><title>kriyative</title></head><body><header id="banner"><div class="sleeve"><hgroup id="nameplate"><h1 id="title"><a href="/">kriyative</a></h1><h2 id="description"></h2></hgroup><nav id="toc"><ul id="menu"><li class="menu-item"><a href="/archives">Archives</a></li><li class="menu-item"><a href="/tags">Tags</a></li><li class="menu-item"><a href="/rss.xml">Subscribe</a></li></ul></nav></div></header><div id="main"><div class="sleeve"><div id="content"><article class="post format-standard"><header class="post-header"><h1 class="post-title"><a href="/2011/03/26/ecl-for-ios-updated/">ECL for iOS update for ECL-11.1.1, Xocde 4, and SDK 4.3</a></h1><p class="post-meta">Posted on 26 Mar 2011</p></header><div class="post-content">
<p>I've committed a new branch of ECL for iOS, which now requires
ECL-11.1.1 (latest stable), and produces functioning device binaries
for armv6 and armv7 architectures using Xcode 4 and SDK 4.3. This
release has been tested on iPhone and iPad devices running iOS 4.3.1.
</p>
<p>
Please refer to the updated README for further details.
</p>
<p>
<a href="https://github.com/kriyative/ecl-iphone-builder/tree/elf">https://github.com/kriyative/ecl-iphone-builder/tree/elf</a>
</p>
<p>
Please note that the earlier release branch `dragon' has also been
updated to work with Xcode 4, and SDK 4.3. However, it continues to be
based on ECL-10.4.1.
</p>
<p>
<a href="https://github.com/kriyative/ecl-iphone-builder/tree/dragon">https://github.com/kriyative/ecl-iphone-builder/tree/dragon</a>
</p>
<p>
Many thanks to <a href="http://mclide.in-progress.com/">Terje Norderhaug</a> for his help with this update.
</p></div><footer class="post-footer" /></article><article class="post format-standard"><header class="post-header"><h1 class="post-title"><a href="/2011/01/10/clojurejs-announcement/">clojurejs -- a Clojure (subset) to Javascript translator</a></h1><p class="post-meta">Posted on 10 Jan 2011</p></header><div class="post-content">
<p>I'm releasing <a href="http://github.com/kriyative/clojurejs">clojurejs</a> &ndash; a Clojure library for translating a Clojure
subset language to Javascript. The code is on github reachable at the
following link:
</p>
<p>
<a href="http://github.com/kriyative/clojurejs">http://github.com/kriyative/clojurejs</a>
</p>
<p>
clojurejs is something I've been working on for a few weeks as part of
a larger web app in Clojure. The code's a bit crufty (reflects my
incremental discovery of the inconsistencies in Javascript), but
functional and I wanted put something out there for people to check
out. I welcome bug reports and feedback. It's been useful for my
specific needs, and I'd be happy if it's even marginally useful to
others.
</p>
<p>
I realize there are a number of other efforts to compile/translate
Clojure (or other Lisp subset) to Javascript, but nothing quite fit my
requirements, which prompted me to build clojurejs. Some useful
aspects of clojurejs are:
</p>
<ul>
<li>Consistent scoping in let and loop/recur forms
</li>
<li>Macros with defmacro
</li>
<li>Implicit return from all forms
</li>
<li>loop/recur translates to Javascript for loops
</li>
<li>Translates Clojure vectors, strings, keywords, symbols and maps to
  Javascript equivalents
</li>
<li>dot form access to methods and properties
</li>
</ul>


<p>
Here's an example from the README:
</p>
<pre class="example">
(js
 (defn join [arr delim]
   (loop [str (get arr 0)
          i 1]
     (if (&lt; i (length arr))
       (recur (+ str delim (get arr i))
              (+ i 1))
       str))))
</pre>


<p>
translates to the following Javascript:
</p>

<pre class="example">
join = function(arr, delim) {
    return (function () {
        for (var str = arr[0],i = 1; true;) {
            if ((i &lt; arr.length)) {
                str = (str + delim + arr[i]);
                i = (i + 1);
                continue;
            } else {
                return str;
            } break;
        }
    })();
}
</pre>


<p>
Documentation is regrettably scarce, but there are more details in the
README file, boot.cljs, and the unit tests. I hope to add more
documentation and examples in the next few weeks. Stay tuned.
</p></div><footer class="post-footer" /></article><article class="post format-standard"><header class="post-header"><h1 class="post-title"><a href="/2010/12/20/lisp-functions-ui-callbacks-ecl-ios/">Lisp functions as UI callbacks in ECL/iOS</a></h1><p class="post-meta">Posted on 20 Dec 2010</p></header><div class="post-content">
<p>There's been a bit of recent interest in building "real" apps using
ECL/iOS. While the `eclffi' sample code in the <a href="https://github.com/kriyative/ecl-iphone-builder/tree/centaur">ecl-iphone-builder</a> repo
included examples of how to create/call Objective-C classes/methods
from Lisp, it was missing the glue to go the other way, which was
necessary to implement callbacks in Lisp. I've pushed an update to
github which adds this functionality.
</p>
<p>
As an example I created a subclass of <code>UIButton</code> called <code>UIButtonCB</code>
with one instance var called <code>clickHandler</code>, which can be set to a
Lisp function pointer. The <code>UIButtonCB</code> class wires the
<code>UIControlEventTouchUpInside</code> event to the specified handler function.
</p>
<pre class="example">
@implementation UIButtonCB

- (id) initWithFrame: (CGRect) aFrame
{
    [super initWithFrame: aFrame];
    clickHandler = Cnil;
    [self addTarget: self action: @selector(clicked:) forControlEvents: UIControlEventTouchUpInside];
    return self;
}

- (void) setClickHandler: (cl_object) fun
{
    register_cb(clickHandler, fun);
}

- (void) clicked: (id) sender
{
    if (Cnil != clickHandler) {
        cl_funcall(2, clickHandler, ecl_foreign_data_ref_elt(&amp;sender,ECL_FFI_POINTER_VOID));
    }
}

- (void) dealloc
{
    remove_cb(clickHandler);
    clickHandler = Cnil;
    [super dealloc];
}
</pre>


<p>
The call to <code>register_cb()</code> ensures that the callback function is
protected from GC, and <code>remove_cb()</code> makes the function GC'able
again. <code>UIButtonCB</code> can now be wrapped in Lisp with the following FFI
glue:
</p>
<pre class="example">
(defun set-click-handler (view fun)
  (when fun
    (c-fficall ((view :pointer-void)
                ((make-callback-function fun) :object))
        :void
      "[#0 setClickHandler: #1];")))

(defun make-button (&amp;rest init-view-args &amp;key title title-color icon
                    on-click (enabled t) &amp;allow-other-keys)
  (let ((view (make-view-instance "UIButtonCB" init-view-args)))
    (set-click-handler view on-click)
    (when icon (set-image view icon))
    (when title (set-title view title))
    (when title-color (set-title-color view title-color))
    (set-enabled view enabled)
    view))
</pre>


<p>
Here's an example of the Lisp code to create a button with an on-click
callback, which updates a label:
</p>
<pre class="example">
(let ((n 0)
      (label (make-label "" :frame '(10.0 50.0 300.0 35.0))))
  (add-subview (key-window) label)
  (add-subview (key-window)
               (make-button :frame '(140 230 40 20)
                            :title "click"
                            :background-color (color-argb 1 0.5 0.5 0.5)
                            :on-click (lambda (button)
                                        (declare (ignore button))
                                        (set-text label
                                                  (format nil
                                                          "~d click~:p"
                                                          (incf n)))))))
</pre>


<p>
Obviously, this isn't a very sophisticated approach, but it's a
start. It requires subclassing each UIControl or UIView to add the
vars to store the Lisp callbacks. I'm sure there's ample room for
abstracting or automating some of this boilerplate Objective C code.
</p></div><footer class="post-footer" /></article><article class="post format-standard"><header class="post-header"><h1 class="post-title"><a href="/2010/12/14/ecl-for-ios-updated/">ECL for iOS updated to work with SDK 4.2</a></h1><p class="post-meta">Posted on 14 Dec 2010</p></header><div class="post-content">
<p>I've pushed a new branch (centaur) of the ECL for iOS project to
github, which contains a number of fixes to get ECL compiled under the
latest 4.2 SDK from Apple. This release has been tested on iPhone and
iPad devices running iOS 4.2 as well as the older 3.1.3. Please refer
to the updated README for further details.
</p>
<p>
<a href="http://github.com/kriyative/ecl-iphone-builder/tree/centaur">http://github.com/kriyative/ecl-iphone-builder/tree/centaur</a>
</p>
<p>
Many thanks to <a href="http://mclide.in-progress.com/">Terje Norderhaug</a> and <a href="http://www.facebook.com/profile.php?id=1019202159">Anthony Fairchild</a> for their bug
reports and feedback.
</p></div><footer class="post-footer" /></article><article class="post format-standard"><header class="post-header"><h1 class="post-title"><a href="/2010/03/23/daily-org-agenda-reminder/">Displaying a daily Org-mode agenda reminder in Emacs</a></h1><p class="post-meta">Posted on 23 Mar 2010</p></header><div class="post-content">
<p>Here's a simple hack to get an Org-mode agenda view to popup in an
Emacs buffer, daily at a specified time.
</p>
<pre class="example">
(defvar daily-agenda-timer (parse-relative-time "9:00 am"))
;; (decode-time daily-agenda-timer)
 
(defun show-daily-agenda ()
  (unless (time-less-p (current-time) daily-agenda-timer)
    (setq daily-agenda-timer (time-add daily-agenda-timer
                                     (seconds-to-time 86400)))
    (org-agenda-list)))
 
(add-hook 'display-time-hook 'show-daily-agenda)
(display-time)
</pre>


<p>
The <code>parse-relative-time</code> function helps in initializing the
<code>daily-agenda-timer</code> using a human readable string.
</p>
<pre class="example">
(defun parse-relative-time (time-str)
  (destructuring-bind (sec min hour day month year dow dst zone)
      (parse-time-string time-str)
    (destructuring-bind (sec1 min1 hour1 day1 month1 year1 dow1 dst1 zone1)
      (decode-time)
      (encode-time (or sec sec1)
                 (or min min1)
                 (or hour hour1)
                 (or day day1)
                 (or month month1)
                 (or year year1)
                 (or zone zone1)))))
</pre>

</div><footer class="post-footer" /></article><div class="pager-left"><a href="/latest-posts/2/">&laquo; Older Entries</a></div><div class="pager-right"><a href="/latest-posts/4/">Newer Entries &raquo;</a></div></div><aside id="sidebar"><section class="panel"><p><img id="profile-pic" src="http://www.gravatar.com/avatar/6dcf36ddd0aa73e04e125e3c10f6ff05.png" />Hi, I'm Ram Krishnan - a <a href="http://en.wikipedia.org/wiki/Lisp_(programming_language)">Lisp</a> programmer and software entrepreneur.</p></section><section class="panel"><h1>Links</h1><ul><li><a href="https://github.com/kriyative">Github</a></li><li><a href="http://www.ingeniousmonkey.com">IngeniousMonkey</a></li></ul><p>I sometimes post on <a href="http://twitter.com/funcall">twitter</a>.</p></section><section class="panel"><h1>Recent posts</h1><ul><li><a href="/2013/03/03/clojure-mode-and-slime/"> clojure-mode and slime</a></li><li><a href="/2013/03/02/clojure-emacs-docs-redux/"> clojure, emacs, and docs redux</a></li><li><a href="/2013/02/20/new-site/"> New Site</a></li><li><a href="/2012/07/28/emacs-for-clojure-2/">Emacs for Clojure - Part 2</a></li><li><a href="/2012/07/21/emacs-for-clojure-1/">Emacs for Clojure - Part 1</a></li><li><a href="/2011/03/26/ecl-for-ios-updated/">ECL for iOS update for ECL-11.1.1, Xocde 4, and SDK 4.3</a></li><li><a href="/2011/01/10/clojurejs-announcement/">clojurejs -- a Clojure (subset) to Javascript translator</a></li><li><a href="/2010/12/20/lisp-functions-ui-callbacks-ecl-ios/">Lisp functions as UI callbacks in ECL/iOS</a></li><li><a href="/2010/12/14/ecl-for-ios-updated/">ECL for iOS updated to work with SDK 4.2</a></li><li><a href="/2010/03/23/daily-org-agenda-reminder/">Displaying a daily Org-mode agenda reminder in Emacs</a></li></ul></section></aside></div></div><footer id="addendum"><div class="sleeve"><p id="copyright">Copyright © 2012–2013 Ram Krishnan</p></div></footer><script type="text/javascript">var _gaq = _gaq || [];
       _gaq.push(['_setAccount', 'UA-3082079-6']);
       _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
       })();</script></body></html>